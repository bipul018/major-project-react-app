import V from"./__vite-browser-external-BIHI7g3E.js";import{g as Ir}from"./index-B2_oYZr1.js";var it={},Ee={},vt;function Tr(){if(vt)return Ee;vt=1,Ee.byteLength=l,Ee.toByteArray=_,Ee.fromByteArray=b;for(var s=[],r=[],i=typeof Uint8Array<"u"?Uint8Array:Array,a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",f=0,c=a.length;f<c;++f)s[f]=a[f],r[a.charCodeAt(f)]=f;r[45]=62,r[95]=63;function p(g){var w=g.length;if(w%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var x=g.indexOf("=");x===-1&&(x=w);var B=x===w?0:4-x%4;return[x,B]}function l(g){var w=p(g),x=w[0],B=w[1];return(x+B)*3/4-B}function m(g,w,x){return(w+x)*3/4-x}function _(g){var w,x=p(g),B=x[0],U=x[1],T=new i(m(g,B,U)),F=0,D=U>0?B-4:B,O;for(O=0;O<D;O+=4)w=r[g.charCodeAt(O)]<<18|r[g.charCodeAt(O+1)]<<12|r[g.charCodeAt(O+2)]<<6|r[g.charCodeAt(O+3)],T[F++]=w>>16&255,T[F++]=w>>8&255,T[F++]=w&255;return U===2&&(w=r[g.charCodeAt(O)]<<2|r[g.charCodeAt(O+1)]>>4,T[F++]=w&255),U===1&&(w=r[g.charCodeAt(O)]<<10|r[g.charCodeAt(O+1)]<<4|r[g.charCodeAt(O+2)]>>2,T[F++]=w>>8&255,T[F++]=w&255),T}function E(g){return s[g>>18&63]+s[g>>12&63]+s[g>>6&63]+s[g&63]}function y(g,w,x){for(var B,U=[],T=w;T<x;T+=3)B=(g[T]<<16&16711680)+(g[T+1]<<8&65280)+(g[T+2]&255),U.push(E(B));return U.join("")}function b(g){for(var w,x=g.length,B=x%3,U=[],T=16383,F=0,D=x-B;F<D;F+=T)U.push(y(g,F,F+T>D?D:F+T));return B===1?(w=g[x-1],U.push(s[w>>2]+s[w<<4&63]+"==")):B===2&&(w=(g[x-2]<<8)+g[x-1],U.push(s[w>>10]+s[w>>4&63]+s[w<<2&63]+"=")),U.join("")}return Ee}var Ne={};/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */var Bt;function Cr(){return Bt||(Bt=1,Ne.read=function(s,r,i,a,f){var c,p,l=f*8-a-1,m=(1<<l)-1,_=m>>1,E=-7,y=i?f-1:0,b=i?-1:1,g=s[r+y];for(y+=b,c=g&(1<<-E)-1,g>>=-E,E+=l;E>0;c=c*256+s[r+y],y+=b,E-=8);for(p=c&(1<<-E)-1,c>>=-E,E+=a;E>0;p=p*256+s[r+y],y+=b,E-=8);if(c===0)c=1-_;else{if(c===m)return p?NaN:(g?-1:1)*(1/0);p=p+Math.pow(2,a),c=c-_}return(g?-1:1)*p*Math.pow(2,c-a)},Ne.write=function(s,r,i,a,f,c){var p,l,m,_=c*8-f-1,E=(1<<_)-1,y=E>>1,b=f===23?Math.pow(2,-24)-Math.pow(2,-77):0,g=a?0:c-1,w=a?1:-1,x=r<0||r===0&&1/r<0?1:0;for(r=Math.abs(r),isNaN(r)||r===1/0?(l=isNaN(r)?1:0,p=E):(p=Math.floor(Math.log(r)/Math.LN2),r*(m=Math.pow(2,-p))<1&&(p--,m*=2),p+y>=1?r+=b/m:r+=b*Math.pow(2,1-y),r*m>=2&&(p++,m/=2),p+y>=E?(l=0,p=E):p+y>=1?(l=(r*m-1)*Math.pow(2,f),p=p+y):(l=r*Math.pow(2,y-1)*Math.pow(2,f),p=0));f>=8;s[i+g]=l&255,g+=w,l/=256,f-=8);for(p=p<<f|l,_+=f;_>0;s[i+g]=p&255,g+=w,p/=256,_-=8);s[i+g-w]|=x*128}),Ne}/*!
 * The buffer module from node.js, for the browser.
 *
 * @author   Feross Aboukhadijeh <https://feross.org>
 * @license  MIT
 */var bt;function Ur(){return bt||(bt=1,function(s){const r=Tr(),i=Cr(),a=typeof Symbol=="function"&&typeof Symbol.for=="function"?Symbol.for("nodejs.util.inspect.custom"):null;s.Buffer=l,s.SlowBuffer=T,s.INSPECT_MAX_BYTES=50;const f=2147483647;s.kMaxLength=f,l.TYPED_ARRAY_SUPPORT=c(),!l.TYPED_ARRAY_SUPPORT&&typeof console<"u"&&typeof console.error=="function"&&console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support.");function c(){try{const n=new Uint8Array(1),e={foo:function(){return 42}};return Object.setPrototypeOf(e,Uint8Array.prototype),Object.setPrototypeOf(n,e),n.foo()===42}catch{return!1}}Object.defineProperty(l.prototype,"parent",{enumerable:!0,get:function(){if(l.isBuffer(this))return this.buffer}}),Object.defineProperty(l.prototype,"offset",{enumerable:!0,get:function(){if(l.isBuffer(this))return this.byteOffset}});function p(n){if(n>f)throw new RangeError('The value "'+n+'" is invalid for option "size"');const e=new Uint8Array(n);return Object.setPrototypeOf(e,l.prototype),e}function l(n,e,t){if(typeof n=="number"){if(typeof e=="string")throw new TypeError('The "string" argument must be of type string. Received type number');return y(n)}return m(n,e,t)}l.poolSize=8192;function m(n,e,t){if(typeof n=="string")return b(n,e);if(ArrayBuffer.isView(n))return w(n);if(n==null)throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof n);if(z(n,ArrayBuffer)||n&&z(n.buffer,ArrayBuffer)||typeof SharedArrayBuffer<"u"&&(z(n,SharedArrayBuffer)||n&&z(n.buffer,SharedArrayBuffer)))return x(n,e,t);if(typeof n=="number")throw new TypeError('The "value" argument must not be of type number. Received type number');const o=n.valueOf&&n.valueOf();if(o!=null&&o!==n)return l.from(o,e,t);const u=B(n);if(u)return u;if(typeof Symbol<"u"&&Symbol.toPrimitive!=null&&typeof n[Symbol.toPrimitive]=="function")return l.from(n[Symbol.toPrimitive]("string"),e,t);throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof n)}l.from=function(n,e,t){return m(n,e,t)},Object.setPrototypeOf(l.prototype,Uint8Array.prototype),Object.setPrototypeOf(l,Uint8Array);function _(n){if(typeof n!="number")throw new TypeError('"size" argument must be of type number');if(n<0)throw new RangeError('The value "'+n+'" is invalid for option "size"')}function E(n,e,t){return _(n),n<=0?p(n):e!==void 0?typeof t=="string"?p(n).fill(e,t):p(n).fill(e):p(n)}l.alloc=function(n,e,t){return E(n,e,t)};function y(n){return _(n),p(n<0?0:U(n)|0)}l.allocUnsafe=function(n){return y(n)},l.allocUnsafeSlow=function(n){return y(n)};function b(n,e){if((typeof e!="string"||e==="")&&(e="utf8"),!l.isEncoding(e))throw new TypeError("Unknown encoding: "+e);const t=F(n,e)|0;let o=p(t);const u=o.write(n,e);return u!==t&&(o=o.slice(0,u)),o}function g(n){const e=n.length<0?0:U(n.length)|0,t=p(e);for(let o=0;o<e;o+=1)t[o]=n[o]&255;return t}function w(n){if(z(n,Uint8Array)){const e=new Uint8Array(n);return x(e.buffer,e.byteOffset,e.byteLength)}return g(n)}function x(n,e,t){if(e<0||n.byteLength<e)throw new RangeError('"offset" is outside of buffer bounds');if(n.byteLength<e+(t||0))throw new RangeError('"length" is outside of buffer bounds');let o;return e===void 0&&t===void 0?o=new Uint8Array(n):t===void 0?o=new Uint8Array(n,e):o=new Uint8Array(n,e,t),Object.setPrototypeOf(o,l.prototype),o}function B(n){if(l.isBuffer(n)){const e=U(n.length)|0,t=p(e);return t.length===0||n.copy(t,0,0,e),t}if(n.length!==void 0)return typeof n.length!="number"||rt(n.length)?p(0):g(n);if(n.type==="Buffer"&&Array.isArray(n.data))return g(n.data)}function U(n){if(n>=f)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+f.toString(16)+" bytes");return n|0}function T(n){return+n!=n&&(n=0),l.alloc(+n)}l.isBuffer=function(e){return e!=null&&e._isBuffer===!0&&e!==l.prototype},l.compare=function(e,t){if(z(e,Uint8Array)&&(e=l.from(e,e.offset,e.byteLength)),z(t,Uint8Array)&&(t=l.from(t,t.offset,t.byteLength)),!l.isBuffer(e)||!l.isBuffer(t))throw new TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(e===t)return 0;let o=e.length,u=t.length;for(let h=0,d=Math.min(o,u);h<d;++h)if(e[h]!==t[h]){o=e[h],u=t[h];break}return o<u?-1:u<o?1:0},l.isEncoding=function(e){switch(String(e).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},l.concat=function(e,t){if(!Array.isArray(e))throw new TypeError('"list" argument must be an Array of Buffers');if(e.length===0)return l.alloc(0);let o;if(t===void 0)for(t=0,o=0;o<e.length;++o)t+=e[o].length;const u=l.allocUnsafe(t);let h=0;for(o=0;o<e.length;++o){let d=e[o];if(z(d,Uint8Array))h+d.length>u.length?(l.isBuffer(d)||(d=l.from(d)),d.copy(u,h)):Uint8Array.prototype.set.call(u,d,h);else if(l.isBuffer(d))d.copy(u,h);else throw new TypeError('"list" argument must be an Array of Buffers');h+=d.length}return u};function F(n,e){if(l.isBuffer(n))return n.length;if(ArrayBuffer.isView(n)||z(n,ArrayBuffer))return n.byteLength;if(typeof n!="string")throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof n);const t=n.length,o=arguments.length>2&&arguments[2]===!0;if(!o&&t===0)return 0;let u=!1;for(;;)switch(e){case"ascii":case"latin1":case"binary":return t;case"utf8":case"utf-8":return tt(n).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return t*2;case"hex":return t>>>1;case"base64":return St(n).length;default:if(u)return o?-1:tt(n).length;e=(""+e).toLowerCase(),u=!0}}l.byteLength=F;function D(n,e,t){let o=!1;if((e===void 0||e<0)&&(e=0),e>this.length||((t===void 0||t>this.length)&&(t=this.length),t<=0)||(t>>>=0,e>>>=0,t<=e))return"";for(n||(n="utf8");;)switch(n){case"hex":return me(this,e,t);case"utf8":case"utf-8":return W(this,e,t);case"ascii":return Je(this,e,t);case"latin1":case"binary":return Ce(this,e,t);case"base64":return k(this,e,t);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return Qe(this,e,t);default:if(o)throw new TypeError("Unknown encoding: "+n);n=(n+"").toLowerCase(),o=!0}}l.prototype._isBuffer=!0;function O(n,e,t){const o=n[e];n[e]=n[t],n[t]=o}l.prototype.swap16=function(){const e=this.length;if(e%2!==0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(let t=0;t<e;t+=2)O(this,t,t+1);return this},l.prototype.swap32=function(){const e=this.length;if(e%4!==0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(let t=0;t<e;t+=4)O(this,t,t+3),O(this,t+1,t+2);return this},l.prototype.swap64=function(){const e=this.length;if(e%8!==0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(let t=0;t<e;t+=8)O(this,t,t+7),O(this,t+1,t+6),O(this,t+2,t+5),O(this,t+3,t+4);return this},l.prototype.toString=function(){const e=this.length;return e===0?"":arguments.length===0?W(this,0,e):D.apply(this,arguments)},l.prototype.toLocaleString=l.prototype.toString,l.prototype.equals=function(e){if(!l.isBuffer(e))throw new TypeError("Argument must be a Buffer");return this===e?!0:l.compare(this,e)===0},l.prototype.inspect=function(){let e="";const t=s.INSPECT_MAX_BYTES;return e=this.toString("hex",0,t).replace(/(.{2})/g,"$1 ").trim(),this.length>t&&(e+=" ... "),"<Buffer "+e+">"},a&&(l.prototype[a]=l.prototype.inspect),l.prototype.compare=function(e,t,o,u,h){if(z(e,Uint8Array)&&(e=l.from(e,e.offset,e.byteLength)),!l.isBuffer(e))throw new TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof e);if(t===void 0&&(t=0),o===void 0&&(o=e?e.length:0),u===void 0&&(u=0),h===void 0&&(h=this.length),t<0||o>e.length||u<0||h>this.length)throw new RangeError("out of range index");if(u>=h&&t>=o)return 0;if(u>=h)return-1;if(t>=o)return 1;if(t>>>=0,o>>>=0,u>>>=0,h>>>=0,this===e)return 0;let d=h-u,v=o-t;const L=Math.min(d,v),N=this.slice(u,h),R=e.slice(t,o);for(let C=0;C<L;++C)if(N[C]!==R[C]){d=N[C],v=R[C];break}return d<v?-1:v<d?1:0};function ee(n,e,t,o,u){if(n.length===0)return-1;if(typeof t=="string"?(o=t,t=0):t>2147483647?t=2147483647:t<-2147483648&&(t=-2147483648),t=+t,rt(t)&&(t=u?0:n.length-1),t<0&&(t=n.length+t),t>=n.length){if(u)return-1;t=n.length-1}else if(t<0)if(u)t=0;else return-1;if(typeof e=="string"&&(e=l.from(e,o)),l.isBuffer(e))return e.length===0?-1:te(n,e,t,o,u);if(typeof e=="number")return e=e&255,typeof Uint8Array.prototype.indexOf=="function"?u?Uint8Array.prototype.indexOf.call(n,e,t):Uint8Array.prototype.lastIndexOf.call(n,e,t):te(n,[e],t,o,u);throw new TypeError("val must be string, number or Buffer")}function te(n,e,t,o,u){let h=1,d=n.length,v=e.length;if(o!==void 0&&(o=String(o).toLowerCase(),o==="ucs2"||o==="ucs-2"||o==="utf16le"||o==="utf-16le")){if(n.length<2||e.length<2)return-1;h=2,d/=2,v/=2,t/=2}function L(R,C){return h===1?R[C]:R.readUInt16BE(C*h)}let N;if(u){let R=-1;for(N=t;N<d;N++)if(L(n,N)===L(e,R===-1?0:N-R)){if(R===-1&&(R=N),N-R+1===v)return R*h}else R!==-1&&(N-=N-R),R=-1}else for(t+v>d&&(t=d-v),N=t;N>=0;N--){let R=!0;for(let C=0;C<v;C++)if(L(n,N+C)!==L(e,C)){R=!1;break}if(R)return N}return-1}l.prototype.includes=function(e,t,o){return this.indexOf(e,t,o)!==-1},l.prototype.indexOf=function(e,t,o){return ee(this,e,t,o,!0)},l.prototype.lastIndexOf=function(e,t,o){return ee(this,e,t,o,!1)};function se(n,e,t,o){t=Number(t)||0;const u=n.length-t;o?(o=Number(o),o>u&&(o=u)):o=u;const h=e.length;o>h/2&&(o=h/2);let d;for(d=0;d<o;++d){const v=parseInt(e.substr(d*2,2),16);if(rt(v))return d;n[t+d]=v}return d}function _e(n,e,t,o){return Fe(tt(e,n.length-t),n,t,o)}function Ze(n,e,t,o){return Fe(vr(e),n,t,o)}function S(n,e,t,o){return Fe(St(e),n,t,o)}function I(n,e,t,o){return Fe(Br(e,n.length-t),n,t,o)}l.prototype.write=function(e,t,o,u){if(t===void 0)u="utf8",o=this.length,t=0;else if(o===void 0&&typeof t=="string")u=t,o=this.length,t=0;else if(isFinite(t))t=t>>>0,isFinite(o)?(o=o>>>0,u===void 0&&(u="utf8")):(u=o,o=void 0);else throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");const h=this.length-t;if((o===void 0||o>h)&&(o=h),e.length>0&&(o<0||t<0)||t>this.length)throw new RangeError("Attempt to write outside buffer bounds");u||(u="utf8");let d=!1;for(;;)switch(u){case"hex":return se(this,e,t,o);case"utf8":case"utf-8":return _e(this,e,t,o);case"ascii":case"latin1":case"binary":return Ze(this,e,t,o);case"base64":return S(this,e,t,o);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return I(this,e,t,o);default:if(d)throw new TypeError("Unknown encoding: "+u);u=(""+u).toLowerCase(),d=!0}},l.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};function k(n,e,t){return e===0&&t===n.length?r.fromByteArray(n):r.fromByteArray(n.slice(e,t))}function W(n,e,t){t=Math.min(n.length,t);const o=[];let u=e;for(;u<t;){const h=n[u];let d=null,v=h>239?4:h>223?3:h>191?2:1;if(u+v<=t){let L,N,R,C;switch(v){case 1:h<128&&(d=h);break;case 2:L=n[u+1],(L&192)===128&&(C=(h&31)<<6|L&63,C>127&&(d=C));break;case 3:L=n[u+1],N=n[u+2],(L&192)===128&&(N&192)===128&&(C=(h&15)<<12|(L&63)<<6|N&63,C>2047&&(C<55296||C>57343)&&(d=C));break;case 4:L=n[u+1],N=n[u+2],R=n[u+3],(L&192)===128&&(N&192)===128&&(R&192)===128&&(C=(h&15)<<18|(L&63)<<12|(N&63)<<6|R&63,C>65535&&C<1114112&&(d=C))}}d===null?(d=65533,v=1):d>65535&&(d-=65536,o.push(d>>>10&1023|55296),d=56320|d&1023),o.push(d),u+=v}return M(o)}const Z=4096;function M(n){const e=n.length;if(e<=Z)return String.fromCharCode.apply(String,n);let t="",o=0;for(;o<e;)t+=String.fromCharCode.apply(String,n.slice(o,o+=Z));return t}function Je(n,e,t){let o="";t=Math.min(n.length,t);for(let u=e;u<t;++u)o+=String.fromCharCode(n[u]&127);return o}function Ce(n,e,t){let o="";t=Math.min(n.length,t);for(let u=e;u<t;++u)o+=String.fromCharCode(n[u]);return o}function me(n,e,t){const o=n.length;(!e||e<0)&&(e=0),(!t||t<0||t>o)&&(t=o);let u="";for(let h=e;h<t;++h)u+=br[n[h]];return u}function Qe(n,e,t){const o=n.slice(e,t);let u="";for(let h=0;h<o.length-1;h+=2)u+=String.fromCharCode(o[h]+o[h+1]*256);return u}l.prototype.slice=function(e,t){const o=this.length;e=~~e,t=t===void 0?o:~~t,e<0?(e+=o,e<0&&(e=0)):e>o&&(e=o),t<0?(t+=o,t<0&&(t=0)):t>o&&(t=o),t<e&&(t=e);const u=this.subarray(e,t);return Object.setPrototypeOf(u,l.prototype),u};function P(n,e,t){if(n%1!==0||n<0)throw new RangeError("offset is not uint");if(n+e>t)throw new RangeError("Trying to access beyond buffer length")}l.prototype.readUintLE=l.prototype.readUIntLE=function(e,t,o){e=e>>>0,t=t>>>0,o||P(e,t,this.length);let u=this[e],h=1,d=0;for(;++d<t&&(h*=256);)u+=this[e+d]*h;return u},l.prototype.readUintBE=l.prototype.readUIntBE=function(e,t,o){e=e>>>0,t=t>>>0,o||P(e,t,this.length);let u=this[e+--t],h=1;for(;t>0&&(h*=256);)u+=this[e+--t]*h;return u},l.prototype.readUint8=l.prototype.readUInt8=function(e,t){return e=e>>>0,t||P(e,1,this.length),this[e]},l.prototype.readUint16LE=l.prototype.readUInt16LE=function(e,t){return e=e>>>0,t||P(e,2,this.length),this[e]|this[e+1]<<8},l.prototype.readUint16BE=l.prototype.readUInt16BE=function(e,t){return e=e>>>0,t||P(e,2,this.length),this[e]<<8|this[e+1]},l.prototype.readUint32LE=l.prototype.readUInt32LE=function(e,t){return e=e>>>0,t||P(e,4,this.length),(this[e]|this[e+1]<<8|this[e+2]<<16)+this[e+3]*16777216},l.prototype.readUint32BE=l.prototype.readUInt32BE=function(e,t){return e=e>>>0,t||P(e,4,this.length),this[e]*16777216+(this[e+1]<<16|this[e+2]<<8|this[e+3])},l.prototype.readBigUInt64LE=re(function(e){e=e>>>0,he(e,"offset");const t=this[e],o=this[e+7];(t===void 0||o===void 0)&&ge(e,this.length-8);const u=t+this[++e]*2**8+this[++e]*2**16+this[++e]*2**24,h=this[++e]+this[++e]*2**8+this[++e]*2**16+o*2**24;return BigInt(u)+(BigInt(h)<<BigInt(32))}),l.prototype.readBigUInt64BE=re(function(e){e=e>>>0,he(e,"offset");const t=this[e],o=this[e+7];(t===void 0||o===void 0)&&ge(e,this.length-8);const u=t*2**24+this[++e]*2**16+this[++e]*2**8+this[++e],h=this[++e]*2**24+this[++e]*2**16+this[++e]*2**8+o;return(BigInt(u)<<BigInt(32))+BigInt(h)}),l.prototype.readIntLE=function(e,t,o){e=e>>>0,t=t>>>0,o||P(e,t,this.length);let u=this[e],h=1,d=0;for(;++d<t&&(h*=256);)u+=this[e+d]*h;return h*=128,u>=h&&(u-=Math.pow(2,8*t)),u},l.prototype.readIntBE=function(e,t,o){e=e>>>0,t=t>>>0,o||P(e,t,this.length);let u=t,h=1,d=this[e+--u];for(;u>0&&(h*=256);)d+=this[e+--u]*h;return h*=128,d>=h&&(d-=Math.pow(2,8*t)),d},l.prototype.readInt8=function(e,t){return e=e>>>0,t||P(e,1,this.length),this[e]&128?(255-this[e]+1)*-1:this[e]},l.prototype.readInt16LE=function(e,t){e=e>>>0,t||P(e,2,this.length);const o=this[e]|this[e+1]<<8;return o&32768?o|4294901760:o},l.prototype.readInt16BE=function(e,t){e=e>>>0,t||P(e,2,this.length);const o=this[e+1]|this[e]<<8;return o&32768?o|4294901760:o},l.prototype.readInt32LE=function(e,t){return e=e>>>0,t||P(e,4,this.length),this[e]|this[e+1]<<8|this[e+2]<<16|this[e+3]<<24},l.prototype.readInt32BE=function(e,t){return e=e>>>0,t||P(e,4,this.length),this[e]<<24|this[e+1]<<16|this[e+2]<<8|this[e+3]},l.prototype.readBigInt64LE=re(function(e){e=e>>>0,he(e,"offset");const t=this[e],o=this[e+7];(t===void 0||o===void 0)&&ge(e,this.length-8);const u=this[e+4]+this[e+5]*2**8+this[e+6]*2**16+(o<<24);return(BigInt(u)<<BigInt(32))+BigInt(t+this[++e]*2**8+this[++e]*2**16+this[++e]*2**24)}),l.prototype.readBigInt64BE=re(function(e){e=e>>>0,he(e,"offset");const t=this[e],o=this[e+7];(t===void 0||o===void 0)&&ge(e,this.length-8);const u=(t<<24)+this[++e]*2**16+this[++e]*2**8+this[++e];return(BigInt(u)<<BigInt(32))+BigInt(this[++e]*2**24+this[++e]*2**16+this[++e]*2**8+o)}),l.prototype.readFloatLE=function(e,t){return e=e>>>0,t||P(e,4,this.length),i.read(this,e,!0,23,4)},l.prototype.readFloatBE=function(e,t){return e=e>>>0,t||P(e,4,this.length),i.read(this,e,!1,23,4)},l.prototype.readDoubleLE=function(e,t){return e=e>>>0,t||P(e,8,this.length),i.read(this,e,!0,52,8)},l.prototype.readDoubleBE=function(e,t){return e=e>>>0,t||P(e,8,this.length),i.read(this,e,!1,52,8)};function G(n,e,t,o,u,h){if(!l.isBuffer(n))throw new TypeError('"buffer" argument must be a Buffer instance');if(e>u||e<h)throw new RangeError('"value" argument is out of bounds');if(t+o>n.length)throw new RangeError("Index out of range")}l.prototype.writeUintLE=l.prototype.writeUIntLE=function(e,t,o,u){if(e=+e,t=t>>>0,o=o>>>0,!u){const v=Math.pow(2,8*o)-1;G(this,e,t,o,v,0)}let h=1,d=0;for(this[t]=e&255;++d<o&&(h*=256);)this[t+d]=e/h&255;return t+o},l.prototype.writeUintBE=l.prototype.writeUIntBE=function(e,t,o,u){if(e=+e,t=t>>>0,o=o>>>0,!u){const v=Math.pow(2,8*o)-1;G(this,e,t,o,v,0)}let h=o-1,d=1;for(this[t+h]=e&255;--h>=0&&(d*=256);)this[t+h]=e/d&255;return t+o},l.prototype.writeUint8=l.prototype.writeUInt8=function(e,t,o){return e=+e,t=t>>>0,o||G(this,e,t,1,255,0),this[t]=e&255,t+1},l.prototype.writeUint16LE=l.prototype.writeUInt16LE=function(e,t,o){return e=+e,t=t>>>0,o||G(this,e,t,2,65535,0),this[t]=e&255,this[t+1]=e>>>8,t+2},l.prototype.writeUint16BE=l.prototype.writeUInt16BE=function(e,t,o){return e=+e,t=t>>>0,o||G(this,e,t,2,65535,0),this[t]=e>>>8,this[t+1]=e&255,t+2},l.prototype.writeUint32LE=l.prototype.writeUInt32LE=function(e,t,o){return e=+e,t=t>>>0,o||G(this,e,t,4,4294967295,0),this[t+3]=e>>>24,this[t+2]=e>>>16,this[t+1]=e>>>8,this[t]=e&255,t+4},l.prototype.writeUint32BE=l.prototype.writeUInt32BE=function(e,t,o){return e=+e,t=t>>>0,o||G(this,e,t,4,4294967295,0),this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=e&255,t+4};function Ue(n,e,t,o,u){wt(e,o,u,n,t,7);let h=Number(e&BigInt(4294967295));n[t++]=h,h=h>>8,n[t++]=h,h=h>>8,n[t++]=h,h=h>>8,n[t++]=h;let d=Number(e>>BigInt(32)&BigInt(4294967295));return n[t++]=d,d=d>>8,n[t++]=d,d=d>>8,n[t++]=d,d=d>>8,n[t++]=d,t}function Oe(n,e,t,o,u){wt(e,o,u,n,t,7);let h=Number(e&BigInt(4294967295));n[t+7]=h,h=h>>8,n[t+6]=h,h=h>>8,n[t+5]=h,h=h>>8,n[t+4]=h;let d=Number(e>>BigInt(32)&BigInt(4294967295));return n[t+3]=d,d=d>>8,n[t+2]=d,d=d>>8,n[t+1]=d,d=d>>8,n[t]=d,t+8}l.prototype.writeBigUInt64LE=re(function(e,t=0){return Ue(this,e,t,BigInt(0),BigInt("0xffffffffffffffff"))}),l.prototype.writeBigUInt64BE=re(function(e,t=0){return Oe(this,e,t,BigInt(0),BigInt("0xffffffffffffffff"))}),l.prototype.writeIntLE=function(e,t,o,u){if(e=+e,t=t>>>0,!u){const L=Math.pow(2,8*o-1);G(this,e,t,o,L-1,-L)}let h=0,d=1,v=0;for(this[t]=e&255;++h<o&&(d*=256);)e<0&&v===0&&this[t+h-1]!==0&&(v=1),this[t+h]=(e/d>>0)-v&255;return t+o},l.prototype.writeIntBE=function(e,t,o,u){if(e=+e,t=t>>>0,!u){const L=Math.pow(2,8*o-1);G(this,e,t,o,L-1,-L)}let h=o-1,d=1,v=0;for(this[t+h]=e&255;--h>=0&&(d*=256);)e<0&&v===0&&this[t+h+1]!==0&&(v=1),this[t+h]=(e/d>>0)-v&255;return t+o},l.prototype.writeInt8=function(e,t,o){return e=+e,t=t>>>0,o||G(this,e,t,1,127,-128),e<0&&(e=255+e+1),this[t]=e&255,t+1},l.prototype.writeInt16LE=function(e,t,o){return e=+e,t=t>>>0,o||G(this,e,t,2,32767,-32768),this[t]=e&255,this[t+1]=e>>>8,t+2},l.prototype.writeInt16BE=function(e,t,o){return e=+e,t=t>>>0,o||G(this,e,t,2,32767,-32768),this[t]=e>>>8,this[t+1]=e&255,t+2},l.prototype.writeInt32LE=function(e,t,o){return e=+e,t=t>>>0,o||G(this,e,t,4,2147483647,-2147483648),this[t]=e&255,this[t+1]=e>>>8,this[t+2]=e>>>16,this[t+3]=e>>>24,t+4},l.prototype.writeInt32BE=function(e,t,o){return e=+e,t=t>>>0,o||G(this,e,t,4,2147483647,-2147483648),e<0&&(e=4294967295+e+1),this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=e&255,t+4},l.prototype.writeBigInt64LE=re(function(e,t=0){return Ue(this,e,t,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))}),l.prototype.writeBigInt64BE=re(function(e,t=0){return Oe(this,e,t,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))});function ye(n,e,t,o,u,h){if(t+o>n.length)throw new RangeError("Index out of range");if(t<0)throw new RangeError("Index out of range")}function gt(n,e,t,o,u){return e=+e,t=t>>>0,u||ye(n,e,t,4),i.write(n,e,t,o,23,4),t+4}l.prototype.writeFloatLE=function(e,t,o){return gt(this,e,t,!0,o)},l.prototype.writeFloatBE=function(e,t,o){return gt(this,e,t,!1,o)};function Et(n,e,t,o,u){return e=+e,t=t>>>0,u||ye(n,e,t,8),i.write(n,e,t,o,52,8),t+8}l.prototype.writeDoubleLE=function(e,t,o){return Et(this,e,t,!0,o)},l.prototype.writeDoubleBE=function(e,t,o){return Et(this,e,t,!1,o)},l.prototype.copy=function(e,t,o,u){if(!l.isBuffer(e))throw new TypeError("argument should be a Buffer");if(o||(o=0),!u&&u!==0&&(u=this.length),t>=e.length&&(t=e.length),t||(t=0),u>0&&u<o&&(u=o),u===o||e.length===0||this.length===0)return 0;if(t<0)throw new RangeError("targetStart out of bounds");if(o<0||o>=this.length)throw new RangeError("Index out of range");if(u<0)throw new RangeError("sourceEnd out of bounds");u>this.length&&(u=this.length),e.length-t<u-o&&(u=e.length-t+o);const h=u-o;return this===e&&typeof Uint8Array.prototype.copyWithin=="function"?this.copyWithin(t,o,u):Uint8Array.prototype.set.call(e,this.subarray(o,u),t),h},l.prototype.fill=function(e,t,o,u){if(typeof e=="string"){if(typeof t=="string"?(u=t,t=0,o=this.length):typeof o=="string"&&(u=o,o=this.length),u!==void 0&&typeof u!="string")throw new TypeError("encoding must be a string");if(typeof u=="string"&&!l.isEncoding(u))throw new TypeError("Unknown encoding: "+u);if(e.length===1){const d=e.charCodeAt(0);(u==="utf8"&&d<128||u==="latin1")&&(e=d)}}else typeof e=="number"?e=e&255:typeof e=="boolean"&&(e=Number(e));if(t<0||this.length<t||this.length<o)throw new RangeError("Out of range index");if(o<=t)return this;t=t>>>0,o=o===void 0?this.length:o>>>0,e||(e=0);let h;if(typeof e=="number")for(h=t;h<o;++h)this[h]=e;else{const d=l.isBuffer(e)?e:l.from(e,u),v=d.length;if(v===0)throw new TypeError('The value "'+e+'" is invalid for argument "value"');for(h=0;h<o-t;++h)this[h+t]=d[h%v]}return this};const ue={};function et(n,e,t){ue[n]=class extends t{constructor(){super(),Object.defineProperty(this,"message",{value:e.apply(this,arguments),writable:!0,configurable:!0}),this.name=`${this.name} [${n}]`,this.stack,delete this.name}get code(){return n}set code(u){Object.defineProperty(this,"code",{configurable:!0,enumerable:!0,value:u,writable:!0})}toString(){return`${this.name} [${n}]: ${this.message}`}}}et("ERR_BUFFER_OUT_OF_BOUNDS",function(n){return n?`${n} is outside of buffer bounds`:"Attempt to access memory outside buffer bounds"},RangeError),et("ERR_INVALID_ARG_TYPE",function(n,e){return`The "${n}" argument must be of type number. Received type ${typeof e}`},TypeError),et("ERR_OUT_OF_RANGE",function(n,e,t){let o=`The value of "${n}" is out of range.`,u=t;return Number.isInteger(t)&&Math.abs(t)>2**32?u=xt(String(t)):typeof t=="bigint"&&(u=String(t),(t>BigInt(2)**BigInt(32)||t<-(BigInt(2)**BigInt(32)))&&(u=xt(u)),u+="n"),o+=` It must be ${e}. Received ${u}`,o},RangeError);function xt(n){let e="",t=n.length;const o=n[0]==="-"?1:0;for(;t>=o+4;t-=3)e=`_${n.slice(t-3,t)}${e}`;return`${n.slice(0,t)}${e}`}function xr(n,e,t){he(e,"offset"),(n[e]===void 0||n[e+t]===void 0)&&ge(e,n.length-(t+1))}function wt(n,e,t,o,u,h){if(n>t||n<e){const d=typeof e=="bigint"?"n":"";let v;throw e===0||e===BigInt(0)?v=`>= 0${d} and < 2${d} ** ${(h+1)*8}${d}`:v=`>= -(2${d} ** ${(h+1)*8-1}${d}) and < 2 ** ${(h+1)*8-1}${d}`,new ue.ERR_OUT_OF_RANGE("value",v,n)}xr(o,u,h)}function he(n,e){if(typeof n!="number")throw new ue.ERR_INVALID_ARG_TYPE(e,"number",n)}function ge(n,e,t){throw Math.floor(n)!==n?(he(n,t),new ue.ERR_OUT_OF_RANGE("offset","an integer",n)):e<0?new ue.ERR_BUFFER_OUT_OF_BOUNDS:new ue.ERR_OUT_OF_RANGE("offset",`>= 0 and <= ${e}`,n)}const wr=/[^+/0-9A-Za-z-_]/g;function Sr(n){if(n=n.split("=")[0],n=n.trim().replace(wr,""),n.length<2)return"";for(;n.length%4!==0;)n=n+"=";return n}function tt(n,e){e=e||1/0;let t;const o=n.length;let u=null;const h=[];for(let d=0;d<o;++d){if(t=n.charCodeAt(d),t>55295&&t<57344){if(!u){if(t>56319){(e-=3)>-1&&h.push(239,191,189);continue}else if(d+1===o){(e-=3)>-1&&h.push(239,191,189);continue}u=t;continue}if(t<56320){(e-=3)>-1&&h.push(239,191,189),u=t;continue}t=(u-55296<<10|t-56320)+65536}else u&&(e-=3)>-1&&h.push(239,191,189);if(u=null,t<128){if((e-=1)<0)break;h.push(t)}else if(t<2048){if((e-=2)<0)break;h.push(t>>6|192,t&63|128)}else if(t<65536){if((e-=3)<0)break;h.push(t>>12|224,t>>6&63|128,t&63|128)}else if(t<1114112){if((e-=4)<0)break;h.push(t>>18|240,t>>12&63|128,t>>6&63|128,t&63|128)}else throw new Error("Invalid code point")}return h}function vr(n){const e=[];for(let t=0;t<n.length;++t)e.push(n.charCodeAt(t)&255);return e}function Br(n,e){let t,o,u;const h=[];for(let d=0;d<n.length&&!((e-=2)<0);++d)t=n.charCodeAt(d),o=t>>8,u=t%256,h.push(u),h.push(o);return h}function St(n){return r.toByteArray(Sr(n))}function Fe(n,e,t,o){let u;for(u=0;u<o&&!(u+t>=e.length||u>=n.length);++u)e[u+t]=n[u];return u}function z(n,e){return n instanceof e||n!=null&&n.constructor!=null&&n.constructor.name!=null&&n.constructor.name===e.name}function rt(n){return n!==n}const br=function(){const n="0123456789abcdef",e=new Array(256);for(let t=0;t<16;++t){const o=t*16;for(let u=0;u<16;++u)e[o+u]=n[t]+n[u]}return e}();function re(n){return typeof BigInt>"u"?kr:n}function kr(){throw new Error("BigInt not supported")}}(it)),it}var Or=Ur();const Fr=Ir(Or);var K={};function Ie(s){return s&&s.__esModule&&Object.prototype.hasOwnProperty.call(s,"default")?s.default:s}function Nr(s){if(s.__esModule)return s;var r=s.default;if(typeof r=="function"){var i=function a(){return this instanceof a?Reflect.construct(r,arguments,this.constructor):r.apply(this,arguments)};i.prototype=r.prototype}else i={};return Object.defineProperty(i,"__esModule",{value:!0}),Object.keys(s).forEach(function(a){var f=Object.getOwnPropertyDescriptor(s,a);Object.defineProperty(i,a,f.get?f:{enumerable:!0,get:function(){return s[a]}})}),i}const{Duplex:Lr}=V;function kt(s){s.emit("close")}function Rr(){!this.destroyed&&this._writableState.finished&&this.destroy()}function rr(s){this.removeListener("error",rr),this.destroy(),this.listenerCount("error")===0&&this.emit("error",s)}function Ar(s,r){let i=!0;const a=new Lr({...r,autoDestroy:!1,emitClose:!1,objectMode:!1,writableObjectMode:!1});return s.on("message",function(c,p){const l=!p&&a._readableState.objectMode?c.toString():c;a.push(l)||s.pause()}),s.once("error",function(c){a.destroyed||(i=!1,a.destroy(c))}),s.once("close",function(){a.destroyed||a.push(null)}),a._destroy=function(f,c){if(s.readyState===s.CLOSED){c(f),process.nextTick(kt,a);return}let p=!1;s.once("error",function(m){p=!0,c(m)}),s.once("close",function(){p||c(f),process.nextTick(kt,a)}),i&&s.terminate()},a._final=function(f){if(s.readyState===s.CONNECTING){s.once("open",function(){a._final(f)});return}s._socket!==null&&(s._socket._writableState.finished?(f(),a._readableState.endEmitted&&a.destroy()):(s._socket.once("finish",function(){f()}),s.close()))},a._read=function(){s.isPaused&&s.resume()},a._write=function(f,c,p){if(s.readyState===s.CONNECTING){s.once("open",function(){a._write(f,c,p)});return}s.send(f,p)},a.on("end",Rr),a.on("error",rr),a}var Pr=Ar;const dn=Ie(Pr);var je={exports:{}},le={BINARY_TYPES:["nodebuffer","arraybuffer","fragments"],EMPTY_BUFFER:Buffer.alloc(0),GUID:"258EAFA5-E914-47DA-95CA-C5AB0DC85B11",kForOnEventAttribute:Symbol("kIsForOnEventAttribute"),kListener:Symbol("kListener"),kStatusCode:Symbol("status-code"),kWebSocket:Symbol("websocket"),NOOP:()=>{}},Le={exports:{}},Re={exports:{}};function Mr(s){throw new Error('Could not dynamically require "'+s+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var nt,It;function $r(){if(It)return nt;It=1;var s=V,r=V,i=V,a=typeof __webpack_require__=="function"?__non_webpack_require__:Mr,f=process.config&&process.config.variables||{},c=!!K.PREBUILDS_ONLY,p=process.versions.modules,l=_e()?"electron":se()?"node-webkit":"node",m=K.npm_config_arch||i.arch(),_=K.npm_config_platform||i.platform(),E=K.LIBC||(Ze(_)?"musl":"glibc"),y=K.ARM_VERSION||(m==="arm64"?"8":f.arm_version)||"",b=(process.versions.uv||"").split(".")[0];nt=g;function g(S){return a(g.resolve(S))}g.resolve=g.path=function(S){S=r.resolve(S||".");try{var I=a(r.join(S,"package.json")).name.toUpperCase().replace(/-/g,"_");K[I+"_PREBUILD"]&&(S=K[I+"_PREBUILD"])}catch{}if(!c){var k=x(r.join(S,"build/Release"),B);if(k)return k;var W=x(r.join(S,"build/Debug"),B);if(W)return W}var Z=Ce(S);if(Z)return Z;var M=Ce(r.dirname(process.execPath));if(M)return M;var Je=["platform="+_,"arch="+m,"runtime="+l,"abi="+p,"uv="+b,y?"armv="+y:"","libc="+E,"node="+process.versions.node,process.versions.electron?"electron="+process.versions.electron:"",typeof __webpack_require__=="function"?"webpack=true":""].filter(Boolean).join(" ");throw new Error("No native build was found for "+Je+`
    loaded from: `+S+`
`);function Ce(me){var Qe=w(r.join(me,"prebuilds")).map(U),P=Qe.filter(T(_,m)).sort(F)[0];if(P){var G=r.join(me,"prebuilds",P.name),Ue=w(G).map(D),Oe=Ue.filter(O(l,p)),ye=Oe.sort(te(l))[0];if(ye)return r.join(G,ye.file)}}};function w(S){try{return s.readdirSync(S)}catch{return[]}}function x(S,I){var k=w(S).filter(I);return k[0]&&r.join(S,k[0])}function B(S){return/\.node$/.test(S)}function U(S){var I=S.split("-");if(I.length===2){var k=I[0],W=I[1].split("+");if(k&&W.length&&W.every(Boolean))return{name:S,platform:k,architectures:W}}}function T(S,I){return function(k){return k==null||k.platform!==S?!1:k.architectures.includes(I)}}function F(S,I){return S.architectures.length-I.architectures.length}function D(S){var I=S.split("."),k=I.pop(),W={file:S,specificity:0};if(k==="node"){for(var Z=0;Z<I.length;Z++){var M=I[Z];if(M==="node"||M==="electron"||M==="node-webkit")W.runtime=M;else if(M==="napi")W.napi=!0;else if(M.slice(0,3)==="abi")W.abi=M.slice(3);else if(M.slice(0,2)==="uv")W.uv=M.slice(2);else if(M.slice(0,4)==="armv")W.armv=M.slice(4);else if(M==="glibc"||M==="musl")W.libc=M;else continue;W.specificity++}return W}}function O(S,I){return function(k){return!(k==null||k.runtime!==S&&!ee(k)||k.abi!==I&&!k.napi||k.uv&&k.uv!==b||k.armv&&k.armv!==y||k.libc&&k.libc!==E)}}function ee(S){return S.runtime==="node"&&S.napi}function te(S){return function(I,k){return I.runtime!==k.runtime?I.runtime===S?-1:1:I.abi!==k.abi?I.abi?-1:1:I.specificity!==k.specificity?I.specificity>k.specificity?-1:1:0}}function se(){return!!(process.versions&&process.versions.nw)}function _e(){return process.versions&&process.versions.electron||K.ELECTRON_RUN_AS_NODE?!0:typeof window<"u"&&window.process&&window.process.type==="renderer"}function Ze(S){return S==="linux"&&s.existsSync("/etc/alpine-release")}return g.parseTags=D,g.matchTags=O,g.compareTags=te,g.parseTuple=U,g.matchTuple=T,g.compareTuples=F,nt}var Tt;function Dr(){return Tt||(Tt=1,typeof process.addon=="function"?Re.exports=process.addon.bind(process):Re.exports=$r()),Re.exports}var st,Ct;function Wr(){return Ct||(Ct=1,st={mask:(i,a,f,c,p)=>{for(var l=0;l<p;l++)f[c+l]=i[l]^a[l&3]},unmask:(i,a)=>{const f=i.length;for(var c=0;c<f;c++)i[c]^=a[c&3]}}),st}var Ut;function jr(){if(Ut)return Le.exports;Ut=1;try{Le.exports=Dr()(__dirname)}catch{Le.exports=Wr()}return Le.exports}var Gr,Vr;const{EMPTY_BUFFER:qr}=le,dt=Buffer[Symbol.species];function Yr(s,r){if(s.length===0)return qr;if(s.length===1)return s[0];const i=Buffer.allocUnsafe(r);let a=0;for(let f=0;f<s.length;f++){const c=s[f];i.set(c,a),a+=c.length}return a<r?new dt(i.buffer,i.byteOffset,a):i}function ir(s,r,i,a,f){for(let c=0;c<f;c++)i[a+c]=s[c]^r[c&3]}function nr(s,r){for(let i=0;i<s.length;i++)s[i]^=r[i&3]}function Hr(s){return s.length===s.buffer.byteLength?s.buffer:s.buffer.slice(s.byteOffset,s.byteOffset+s.length)}function _t(s){if(_t.readOnly=!0,Buffer.isBuffer(s))return s;let r;return s instanceof ArrayBuffer?r=new dt(s):ArrayBuffer.isView(s)?r=new dt(s.buffer,s.byteOffset,s.byteLength):(r=Buffer.from(s),_t.readOnly=!1),r}je.exports={concat:Yr,mask:ir,toArrayBuffer:Hr,toBuffer:_t,unmask:nr};if(!K.WS_NO_BUFFER_UTIL)try{const s=jr();Vr=je.exports.mask=function(r,i,a,f,c){c<48?ir(r,i,a,f,c):s.mask(r,i,a,f,c)},Gr=je.exports.unmask=function(r,i){r.length<32?nr(r,i):s.unmask(r,i)}}catch{}var Ye=je.exports;const Ot=Symbol("kDone"),ot=Symbol("kRun");let zr=class{constructor(r){this[Ot]=()=>{this.pending--,this[ot]()},this.concurrency=r||1/0,this.jobs=[],this.pending=0}add(r){this.jobs.push(r),this[ot]()}[ot](){if(this.pending!==this.concurrency&&this.jobs.length){const r=this.jobs.shift();this.pending++,r(this[Ot])}}};var Xr=zr;const xe=V,Ft=Ye,Kr=Xr,{kStatusCode:sr}=le,Zr=Buffer[Symbol.species],Jr=Buffer.from([0,0,255,255]),Ge=Symbol("permessage-deflate"),J=Symbol("total-length"),be=Symbol("callback"),ie=Symbol("buffers"),De=Symbol("error");let Ae,Qr=class{constructor(r,i,a){if(this._maxPayload=a|0,this._options=r||{},this._threshold=this._options.threshold!==void 0?this._options.threshold:1024,this._isServer=!!i,this._deflate=null,this._inflate=null,this.params=null,!Ae){const f=this._options.concurrencyLimit!==void 0?this._options.concurrencyLimit:10;Ae=new Kr(f)}}static get extensionName(){return"permessage-deflate"}offer(){const r={};return this._options.serverNoContextTakeover&&(r.server_no_context_takeover=!0),this._options.clientNoContextTakeover&&(r.client_no_context_takeover=!0),this._options.serverMaxWindowBits&&(r.server_max_window_bits=this._options.serverMaxWindowBits),this._options.clientMaxWindowBits?r.client_max_window_bits=this._options.clientMaxWindowBits:this._options.clientMaxWindowBits==null&&(r.client_max_window_bits=!0),r}accept(r){return r=this.normalizeParams(r),this.params=this._isServer?this.acceptAsServer(r):this.acceptAsClient(r),this.params}cleanup(){if(this._inflate&&(this._inflate.close(),this._inflate=null),this._deflate){const r=this._deflate[be];this._deflate.close(),this._deflate=null,r&&r(new Error("The deflate stream was closed while data was being processed"))}}acceptAsServer(r){const i=this._options,a=r.find(f=>!(i.serverNoContextTakeover===!1&&f.server_no_context_takeover||f.server_max_window_bits&&(i.serverMaxWindowBits===!1||typeof i.serverMaxWindowBits=="number"&&i.serverMaxWindowBits>f.server_max_window_bits)||typeof i.clientMaxWindowBits=="number"&&!f.client_max_window_bits));if(!a)throw new Error("None of the extension offers can be accepted");return i.serverNoContextTakeover&&(a.server_no_context_takeover=!0),i.clientNoContextTakeover&&(a.client_no_context_takeover=!0),typeof i.serverMaxWindowBits=="number"&&(a.server_max_window_bits=i.serverMaxWindowBits),typeof i.clientMaxWindowBits=="number"?a.client_max_window_bits=i.clientMaxWindowBits:(a.client_max_window_bits===!0||i.clientMaxWindowBits===!1)&&delete a.client_max_window_bits,a}acceptAsClient(r){const i=r[0];if(this._options.clientNoContextTakeover===!1&&i.client_no_context_takeover)throw new Error('Unexpected parameter "client_no_context_takeover"');if(!i.client_max_window_bits)typeof this._options.clientMaxWindowBits=="number"&&(i.client_max_window_bits=this._options.clientMaxWindowBits);else if(this._options.clientMaxWindowBits===!1||typeof this._options.clientMaxWindowBits=="number"&&i.client_max_window_bits>this._options.clientMaxWindowBits)throw new Error('Unexpected or invalid parameter "client_max_window_bits"');return i}normalizeParams(r){return r.forEach(i=>{Object.keys(i).forEach(a=>{let f=i[a];if(f.length>1)throw new Error(`Parameter "${a}" must have only a single value`);if(f=f[0],a==="client_max_window_bits"){if(f!==!0){const c=+f;if(!Number.isInteger(c)||c<8||c>15)throw new TypeError(`Invalid value for parameter "${a}": ${f}`);f=c}else if(!this._isServer)throw new TypeError(`Invalid value for parameter "${a}": ${f}`)}else if(a==="server_max_window_bits"){const c=+f;if(!Number.isInteger(c)||c<8||c>15)throw new TypeError(`Invalid value for parameter "${a}": ${f}`);f=c}else if(a==="client_no_context_takeover"||a==="server_no_context_takeover"){if(f!==!0)throw new TypeError(`Invalid value for parameter "${a}": ${f}`)}else throw new Error(`Unknown parameter "${a}"`);i[a]=f})}),r}decompress(r,i,a){Ae.add(f=>{this._decompress(r,i,(c,p)=>{f(),a(c,p)})})}compress(r,i,a){Ae.add(f=>{this._compress(r,i,(c,p)=>{f(),a(c,p)})})}_decompress(r,i,a){const f=this._isServer?"client":"server";if(!this._inflate){const c=`${f}_max_window_bits`,p=typeof this.params[c]!="number"?xe.Z_DEFAULT_WINDOWBITS:this.params[c];this._inflate=xe.createInflateRaw({...this._options.zlibInflateOptions,windowBits:p}),this._inflate[Ge]=this,this._inflate[J]=0,this._inflate[ie]=[],this._inflate.on("error",ti),this._inflate.on("data",or)}this._inflate[be]=a,this._inflate.write(r),i&&this._inflate.write(Jr),this._inflate.flush(()=>{const c=this._inflate[De];if(c){this._inflate.close(),this._inflate=null,a(c);return}const p=Ft.concat(this._inflate[ie],this._inflate[J]);this._inflate._readableState.endEmitted?(this._inflate.close(),this._inflate=null):(this._inflate[J]=0,this._inflate[ie]=[],i&&this.params[`${f}_no_context_takeover`]&&this._inflate.reset()),a(null,p)})}_compress(r,i,a){const f=this._isServer?"server":"client";if(!this._deflate){const c=`${f}_max_window_bits`,p=typeof this.params[c]!="number"?xe.Z_DEFAULT_WINDOWBITS:this.params[c];this._deflate=xe.createDeflateRaw({...this._options.zlibDeflateOptions,windowBits:p}),this._deflate[J]=0,this._deflate[ie]=[],this._deflate.on("data",ei)}this._deflate[be]=a,this._deflate.write(r),this._deflate.flush(xe.Z_SYNC_FLUSH,()=>{if(!this._deflate)return;let c=Ft.concat(this._deflate[ie],this._deflate[J]);i&&(c=new Zr(c.buffer,c.byteOffset,c.length-4)),this._deflate[be]=null,this._deflate[J]=0,this._deflate[ie]=[],i&&this.params[`${f}_no_context_takeover`]&&this._deflate.reset(),a(null,c)})}};var He=Qr;function ei(s){this[ie].push(s),this[J]+=s.length}function or(s){if(this[J]+=s.length,this[Ge]._maxPayload<1||this[J]<=this[Ge]._maxPayload){this[ie].push(s);return}this[De]=new RangeError("Max payload size exceeded"),this[De].code="WS_ERR_UNSUPPORTED_MESSAGE_LENGTH",this[De][sr]=1009,this.removeListener("data",or),this.reset()}function ti(s){this[Ge]._inflate=null,s[sr]=1007,this[be](s)}var Ve={exports:{}};const ri={},ii=Object.freeze(Object.defineProperty({__proto__:null,default:ri},Symbol.toStringTag,{value:"Module"})),ni=Nr(ii);var Nt;const{isUtf8:Lt}=Fr,si=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,1,1,1,1,1,0,0,1,1,0,1,1,0,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1,0,1,0];function oi(s){return s>=1e3&&s<=1014&&s!==1004&&s!==1005&&s!==1006||s>=3e3&&s<=4999}function mt(s){const r=s.length;let i=0;for(;i<r;)if(!(s[i]&128))i++;else if((s[i]&224)===192){if(i+1===r||(s[i+1]&192)!==128||(s[i]&254)===192)return!1;i+=2}else if((s[i]&240)===224){if(i+2>=r||(s[i+1]&192)!==128||(s[i+2]&192)!==128||s[i]===224&&(s[i+1]&224)===128||s[i]===237&&(s[i+1]&224)===160)return!1;i+=3}else if((s[i]&248)===240){if(i+3>=r||(s[i+1]&192)!==128||(s[i+2]&192)!==128||(s[i+3]&192)!==128||s[i]===240&&(s[i+1]&240)===128||s[i]===244&&s[i+1]>143||s[i]>244)return!1;i+=4}else return!1;return!0}Ve.exports={isValidStatusCode:oi,isValidUTF8:mt,tokenChars:si};if(Lt)Nt=Ve.exports.isValidUTF8=function(s){return s.length<24?mt(s):Lt(s)};else if(!K.WS_NO_UTF_8_VALIDATE)try{const s=ni;Nt=Ve.exports.isValidUTF8=function(r){return r.length<32?mt(r):s(r)}}catch{}var ze=Ve.exports;const{Writable:ai}=V,Rt=He,{BINARY_TYPES:fi,EMPTY_BUFFER:At,kStatusCode:li,kWebSocket:ci}=le,{concat:at,toArrayBuffer:ui,unmask:hi}=Ye,{isValidStatusCode:pi,isValidUTF8:Pt}=ze,Pe=Buffer[Symbol.species],we=0,Mt=1,$t=2,Dt=3,ft=4,di=5;let _i=class extends ai{constructor(r={}){super(),this._binaryType=r.binaryType||fi[0],this._extensions=r.extensions||{},this._isServer=!!r.isServer,this._maxPayload=r.maxPayload|0,this._skipUTF8Validation=!!r.skipUTF8Validation,this[ci]=void 0,this._bufferedBytes=0,this._buffers=[],this._compressed=!1,this._payloadLength=0,this._mask=void 0,this._fragmented=0,this._masked=!1,this._fin=!1,this._opcode=0,this._totalPayloadLength=0,this._messageLength=0,this._fragments=[],this._state=we,this._loop=!1}_write(r,i,a){if(this._opcode===8&&this._state==we)return a();this._bufferedBytes+=r.length,this._buffers.push(r),this.startLoop(a)}consume(r){if(this._bufferedBytes-=r,r===this._buffers[0].length)return this._buffers.shift();if(r<this._buffers[0].length){const a=this._buffers[0];return this._buffers[0]=new Pe(a.buffer,a.byteOffset+r,a.length-r),new Pe(a.buffer,a.byteOffset,r)}const i=Buffer.allocUnsafe(r);do{const a=this._buffers[0],f=i.length-r;r>=a.length?i.set(this._buffers.shift(),f):(i.set(new Uint8Array(a.buffer,a.byteOffset,r),f),this._buffers[0]=new Pe(a.buffer,a.byteOffset+r,a.length-r)),r-=a.length}while(r>0);return i}startLoop(r){let i;this._loop=!0;do switch(this._state){case we:i=this.getInfo();break;case Mt:i=this.getPayloadLength16();break;case $t:i=this.getPayloadLength64();break;case Dt:this.getMask();break;case ft:i=this.getData(r);break;default:this._loop=!1;return}while(this._loop);r(i)}getInfo(){if(this._bufferedBytes<2){this._loop=!1;return}const r=this.consume(2);if(r[0]&48)return this._loop=!1,j(RangeError,"RSV2 and RSV3 must be clear",!0,1002,"WS_ERR_UNEXPECTED_RSV_2_3");const i=(r[0]&64)===64;if(i&&!this._extensions[Rt.extensionName])return this._loop=!1,j(RangeError,"RSV1 must be clear",!0,1002,"WS_ERR_UNEXPECTED_RSV_1");if(this._fin=(r[0]&128)===128,this._opcode=r[0]&15,this._payloadLength=r[1]&127,this._opcode===0){if(i)return this._loop=!1,j(RangeError,"RSV1 must be clear",!0,1002,"WS_ERR_UNEXPECTED_RSV_1");if(!this._fragmented)return this._loop=!1,j(RangeError,"invalid opcode 0",!0,1002,"WS_ERR_INVALID_OPCODE");this._opcode=this._fragmented}else if(this._opcode===1||this._opcode===2){if(this._fragmented)return this._loop=!1,j(RangeError,`invalid opcode ${this._opcode}`,!0,1002,"WS_ERR_INVALID_OPCODE");this._compressed=i}else if(this._opcode>7&&this._opcode<11){if(!this._fin)return this._loop=!1,j(RangeError,"FIN must be set",!0,1002,"WS_ERR_EXPECTED_FIN");if(i)return this._loop=!1,j(RangeError,"RSV1 must be clear",!0,1002,"WS_ERR_UNEXPECTED_RSV_1");if(this._payloadLength>125||this._opcode===8&&this._payloadLength===1)return this._loop=!1,j(RangeError,`invalid payload length ${this._payloadLength}`,!0,1002,"WS_ERR_INVALID_CONTROL_PAYLOAD_LENGTH")}else return this._loop=!1,j(RangeError,`invalid opcode ${this._opcode}`,!0,1002,"WS_ERR_INVALID_OPCODE");if(!this._fin&&!this._fragmented&&(this._fragmented=this._opcode),this._masked=(r[1]&128)===128,this._isServer){if(!this._masked)return this._loop=!1,j(RangeError,"MASK must be set",!0,1002,"WS_ERR_EXPECTED_MASK")}else if(this._masked)return this._loop=!1,j(RangeError,"MASK must be clear",!0,1002,"WS_ERR_UNEXPECTED_MASK");if(this._payloadLength===126)this._state=Mt;else if(this._payloadLength===127)this._state=$t;else return this.haveLength()}getPayloadLength16(){if(this._bufferedBytes<2){this._loop=!1;return}return this._payloadLength=this.consume(2).readUInt16BE(0),this.haveLength()}getPayloadLength64(){if(this._bufferedBytes<8){this._loop=!1;return}const r=this.consume(8),i=r.readUInt32BE(0);return i>Math.pow(2,21)-1?(this._loop=!1,j(RangeError,"Unsupported WebSocket frame: payload length > 2^53 - 1",!1,1009,"WS_ERR_UNSUPPORTED_DATA_PAYLOAD_LENGTH")):(this._payloadLength=i*Math.pow(2,32)+r.readUInt32BE(4),this.haveLength())}haveLength(){if(this._payloadLength&&this._opcode<8&&(this._totalPayloadLength+=this._payloadLength,this._totalPayloadLength>this._maxPayload&&this._maxPayload>0))return this._loop=!1,j(RangeError,"Max payload size exceeded",!1,1009,"WS_ERR_UNSUPPORTED_MESSAGE_LENGTH");this._masked?this._state=Dt:this._state=ft}getMask(){if(this._bufferedBytes<4){this._loop=!1;return}this._mask=this.consume(4),this._state=ft}getData(r){let i=At;if(this._payloadLength){if(this._bufferedBytes<this._payloadLength){this._loop=!1;return}i=this.consume(this._payloadLength),this._masked&&this._mask[0]|this._mask[1]|this._mask[2]|this._mask[3]&&hi(i,this._mask)}if(this._opcode>7)return this.controlMessage(i);if(this._compressed){this._state=di,this.decompress(i,r);return}return i.length&&(this._messageLength=this._totalPayloadLength,this._fragments.push(i)),this.dataMessage()}decompress(r,i){this._extensions[Rt.extensionName].decompress(r,this._fin,(f,c)=>{if(f)return i(f);if(c.length){if(this._messageLength+=c.length,this._messageLength>this._maxPayload&&this._maxPayload>0)return i(j(RangeError,"Max payload size exceeded",!1,1009,"WS_ERR_UNSUPPORTED_MESSAGE_LENGTH"));this._fragments.push(c)}const p=this.dataMessage();if(p)return i(p);this.startLoop(i)})}dataMessage(){if(this._fin){const r=this._messageLength,i=this._fragments;if(this._totalPayloadLength=0,this._messageLength=0,this._fragmented=0,this._fragments=[],this._opcode===2){let a;this._binaryType==="nodebuffer"?a=at(i,r):this._binaryType==="arraybuffer"?a=ui(at(i,r)):a=i,this.emit("message",a,!0)}else{const a=at(i,r);if(!this._skipUTF8Validation&&!Pt(a))return this._loop=!1,j(Error,"invalid UTF-8 sequence",!0,1007,"WS_ERR_INVALID_UTF8");this.emit("message",a,!1)}}this._state=we}controlMessage(r){if(this._opcode===8)if(this._loop=!1,r.length===0)this.emit("conclude",1005,At),this.end();else{const i=r.readUInt16BE(0);if(!pi(i))return j(RangeError,`invalid status code ${i}`,!0,1002,"WS_ERR_INVALID_CLOSE_CODE");const a=new Pe(r.buffer,r.byteOffset+2,r.length-2);if(!this._skipUTF8Validation&&!Pt(a))return j(Error,"invalid UTF-8 sequence",!0,1007,"WS_ERR_INVALID_UTF8");this.emit("conclude",i,a),this.end()}else this._opcode===9?this.emit("ping",r):this.emit("pong",r);this._state=we}};var ar=_i;function j(s,r,i,a,f){const c=new s(i?`Invalid WebSocket frame: ${r}`:r);return Error.captureStackTrace(c,j),c.code=f,c[li]=a,c}const gn=Ie(ar),{randomFillSync:mi}=V,Wt=He,{EMPTY_BUFFER:yi}=le,{isValidStatusCode:gi}=ze,{mask:jt,toBuffer:pe}=Ye,H=Symbol("kByteLength"),Ei=Buffer.alloc(4);let xi=class ae{constructor(r,i,a){this._extensions=i||{},a&&(this._generateMask=a,this._maskBuffer=Buffer.alloc(4)),this._socket=r,this._firstFragment=!0,this._compress=!1,this._bufferedBytes=0,this._deflating=!1,this._queue=[]}static frame(r,i){let a,f=!1,c=2,p=!1;i.mask&&(a=i.maskBuffer||Ei,i.generateMask?i.generateMask(a):mi(a,0,4),p=(a[0]|a[1]|a[2]|a[3])===0,c=6);let l;typeof r=="string"?(!i.mask||p)&&i[H]!==void 0?l=i[H]:(r=Buffer.from(r),l=r.length):(l=r.length,f=i.mask&&i.readOnly&&!p);let m=l;l>=65536?(c+=8,m=127):l>125&&(c+=2,m=126);const _=Buffer.allocUnsafe(f?l+c:c);return _[0]=i.fin?i.opcode|128:i.opcode,i.rsv1&&(_[0]|=64),_[1]=m,m===126?_.writeUInt16BE(l,2):m===127&&(_[2]=_[3]=0,_.writeUIntBE(l,4,6)),i.mask?(_[1]|=128,_[c-4]=a[0],_[c-3]=a[1],_[c-2]=a[2],_[c-1]=a[3],p?[_,r]:f?(jt(r,a,_,c,l),[_]):(jt(r,a,r,0,l),[_,r])):[_,r]}close(r,i,a,f){let c;if(r===void 0)c=yi;else{if(typeof r!="number"||!gi(r))throw new TypeError("First argument must be a valid error code number");if(i===void 0||!i.length)c=Buffer.allocUnsafe(2),c.writeUInt16BE(r,0);else{const l=Buffer.byteLength(i);if(l>123)throw new RangeError("The message must not be greater than 123 bytes");c=Buffer.allocUnsafe(2+l),c.writeUInt16BE(r,0),typeof i=="string"?c.write(i,2):c.set(i,2)}}const p={[H]:c.length,fin:!0,generateMask:this._generateMask,mask:a,maskBuffer:this._maskBuffer,opcode:8,readOnly:!1,rsv1:!1};this._deflating?this.enqueue([this.dispatch,c,!1,p,f]):this.sendFrame(ae.frame(c,p),f)}ping(r,i,a){let f,c;if(typeof r=="string"?(f=Buffer.byteLength(r),c=!1):(r=pe(r),f=r.length,c=pe.readOnly),f>125)throw new RangeError("The data size must not be greater than 125 bytes");const p={[H]:f,fin:!0,generateMask:this._generateMask,mask:i,maskBuffer:this._maskBuffer,opcode:9,readOnly:c,rsv1:!1};this._deflating?this.enqueue([this.dispatch,r,!1,p,a]):this.sendFrame(ae.frame(r,p),a)}pong(r,i,a){let f,c;if(typeof r=="string"?(f=Buffer.byteLength(r),c=!1):(r=pe(r),f=r.length,c=pe.readOnly),f>125)throw new RangeError("The data size must not be greater than 125 bytes");const p={[H]:f,fin:!0,generateMask:this._generateMask,mask:i,maskBuffer:this._maskBuffer,opcode:10,readOnly:c,rsv1:!1};this._deflating?this.enqueue([this.dispatch,r,!1,p,a]):this.sendFrame(ae.frame(r,p),a)}send(r,i,a){const f=this._extensions[Wt.extensionName];let c=i.binary?2:1,p=i.compress,l,m;if(typeof r=="string"?(l=Buffer.byteLength(r),m=!1):(r=pe(r),l=r.length,m=pe.readOnly),this._firstFragment?(this._firstFragment=!1,p&&f&&f.params[f._isServer?"server_no_context_takeover":"client_no_context_takeover"]&&(p=l>=f._threshold),this._compress=p):(p=!1,c=0),i.fin&&(this._firstFragment=!0),f){const _={[H]:l,fin:i.fin,generateMask:this._generateMask,mask:i.mask,maskBuffer:this._maskBuffer,opcode:c,readOnly:m,rsv1:p};this._deflating?this.enqueue([this.dispatch,r,this._compress,_,a]):this.dispatch(r,this._compress,_,a)}else this.sendFrame(ae.frame(r,{[H]:l,fin:i.fin,generateMask:this._generateMask,mask:i.mask,maskBuffer:this._maskBuffer,opcode:c,readOnly:m,rsv1:!1}),a)}dispatch(r,i,a,f){if(!i){this.sendFrame(ae.frame(r,a),f);return}const c=this._extensions[Wt.extensionName];this._bufferedBytes+=a[H],this._deflating=!0,c.compress(r,a.fin,(p,l)=>{if(this._socket.destroyed){const m=new Error("The socket was closed while data was being compressed");typeof f=="function"&&f(m);for(let _=0;_<this._queue.length;_++){const E=this._queue[_],y=E[E.length-1];typeof y=="function"&&y(m)}return}this._bufferedBytes-=a[H],this._deflating=!1,a.readOnly=!1,this.sendFrame(ae.frame(l,a),f),this.dequeue()})}dequeue(){for(;!this._deflating&&this._queue.length;){const r=this._queue.shift();this._bufferedBytes-=r[3][H],Reflect.apply(r[0],this,r.slice(1))}}enqueue(r){this._bufferedBytes+=r[3][H],this._queue.push(r)}sendFrame(r,i){r.length===2?(this._socket.cork(),this._socket.write(r[0]),this._socket.write(r[1],i),this._socket.uncork()):this._socket.write(r[0],i)}};var fr=xi;const En=Ie(fr),{kForOnEventAttribute:Se,kListener:lt}=le,Gt=Symbol("kCode"),Vt=Symbol("kData"),qt=Symbol("kError"),Yt=Symbol("kMessage"),Ht=Symbol("kReason"),de=Symbol("kTarget"),zt=Symbol("kType"),Xt=Symbol("kWasClean");class ce{constructor(r){this[de]=null,this[zt]=r}get target(){return this[de]}get type(){return this[zt]}}Object.defineProperty(ce.prototype,"target",{enumerable:!0});Object.defineProperty(ce.prototype,"type",{enumerable:!0});class Te extends ce{constructor(r,i={}){super(r),this[Gt]=i.code===void 0?0:i.code,this[Ht]=i.reason===void 0?"":i.reason,this[Xt]=i.wasClean===void 0?!1:i.wasClean}get code(){return this[Gt]}get reason(){return this[Ht]}get wasClean(){return this[Xt]}}Object.defineProperty(Te.prototype,"code",{enumerable:!0});Object.defineProperty(Te.prototype,"reason",{enumerable:!0});Object.defineProperty(Te.prototype,"wasClean",{enumerable:!0});class Xe extends ce{constructor(r,i={}){super(r),this[qt]=i.error===void 0?null:i.error,this[Yt]=i.message===void 0?"":i.message}get error(){return this[qt]}get message(){return this[Yt]}}Object.defineProperty(Xe.prototype,"error",{enumerable:!0});Object.defineProperty(Xe.prototype,"message",{enumerable:!0});class yt extends ce{constructor(r,i={}){super(r),this[Vt]=i.data===void 0?null:i.data}get data(){return this[Vt]}}Object.defineProperty(yt.prototype,"data",{enumerable:!0});const wi={addEventListener(s,r,i={}){for(const f of this.listeners(s))if(!i[Se]&&f[lt]===r&&!f[Se])return;let a;if(s==="message")a=function(c,p){const l=new yt("message",{data:p?c:c.toString()});l[de]=this,Me(r,this,l)};else if(s==="close")a=function(c,p){const l=new Te("close",{code:c,reason:p.toString(),wasClean:this._closeFrameReceived&&this._closeFrameSent});l[de]=this,Me(r,this,l)};else if(s==="error")a=function(c){const p=new Xe("error",{error:c,message:c.message});p[de]=this,Me(r,this,p)};else if(s==="open")a=function(){const c=new ce("open");c[de]=this,Me(r,this,c)};else return;a[Se]=!!i[Se],a[lt]=r,i.once?this.once(s,a):this.on(s,a)},removeEventListener(s,r){for(const i of this.listeners(s))if(i[lt]===r&&!i[Se]){this.removeListener(s,i);break}}};var Si={CloseEvent:Te,ErrorEvent:Xe,Event:ce,EventTarget:wi,MessageEvent:yt};function Me(s,r,i){typeof s=="object"&&s.handleEvent?s.handleEvent.call(s,i):s.call(r,i)}const{tokenChars:ve}=ze;function X(s,r,i){s[r]===void 0?s[r]=[i]:s[r].push(i)}function vi(s){const r=Object.create(null);let i=Object.create(null),a=!1,f=!1,c=!1,p,l,m=-1,_=-1,E=-1,y=0;for(;y<s.length;y++)if(_=s.charCodeAt(y),p===void 0)if(E===-1&&ve[_]===1)m===-1&&(m=y);else if(y!==0&&(_===32||_===9))E===-1&&m!==-1&&(E=y);else if(_===59||_===44){if(m===-1)throw new SyntaxError(`Unexpected character at index ${y}`);E===-1&&(E=y);const g=s.slice(m,E);_===44?(X(r,g,i),i=Object.create(null)):p=g,m=E=-1}else throw new SyntaxError(`Unexpected character at index ${y}`);else if(l===void 0)if(E===-1&&ve[_]===1)m===-1&&(m=y);else if(_===32||_===9)E===-1&&m!==-1&&(E=y);else if(_===59||_===44){if(m===-1)throw new SyntaxError(`Unexpected character at index ${y}`);E===-1&&(E=y),X(i,s.slice(m,E),!0),_===44&&(X(r,p,i),i=Object.create(null),p=void 0),m=E=-1}else if(_===61&&m!==-1&&E===-1)l=s.slice(m,y),m=E=-1;else throw new SyntaxError(`Unexpected character at index ${y}`);else if(f){if(ve[_]!==1)throw new SyntaxError(`Unexpected character at index ${y}`);m===-1?m=y:a||(a=!0),f=!1}else if(c)if(ve[_]===1)m===-1&&(m=y);else if(_===34&&m!==-1)c=!1,E=y;else if(_===92)f=!0;else throw new SyntaxError(`Unexpected character at index ${y}`);else if(_===34&&s.charCodeAt(y-1)===61)c=!0;else if(E===-1&&ve[_]===1)m===-1&&(m=y);else if(m!==-1&&(_===32||_===9))E===-1&&(E=y);else if(_===59||_===44){if(m===-1)throw new SyntaxError(`Unexpected character at index ${y}`);E===-1&&(E=y);let g=s.slice(m,E);a&&(g=g.replace(/\\/g,""),a=!1),X(i,l,g),_===44&&(X(r,p,i),i=Object.create(null),p=void 0),l=void 0,m=E=-1}else throw new SyntaxError(`Unexpected character at index ${y}`);if(m===-1||c||_===32||_===9)throw new SyntaxError("Unexpected end of input");E===-1&&(E=y);const b=s.slice(m,E);return p===void 0?X(r,b,i):(l===void 0?X(i,b,!0):a?X(i,l,b.replace(/\\/g,"")):X(i,l,b),X(r,p,i)),r}function Bi(s){return Object.keys(s).map(r=>{let i=s[r];return Array.isArray(i)||(i=[i]),i.map(a=>[r].concat(Object.keys(a).map(f=>{let c=a[f];return Array.isArray(c)||(c=[c]),c.map(p=>p===!0?f:`${f}=${p}`).join("; ")})).join("; ")).join(", ")}).join(", ")}var lr={format:Bi,parse:vi};const bi=V,ki=V,Ii=V,cr=V,Ti=V,{randomBytes:Ci,createHash:Ui}=V,{URL:ct}=V,ne=He,Oi=ar,Fi=fr,{BINARY_TYPES:Kt,EMPTY_BUFFER:$e,GUID:Ni,kForOnEventAttribute:ut,kListener:Li,kStatusCode:Ri,kWebSocket:q,NOOP:ur}=le,{EventTarget:{addEventListener:Ai,removeEventListener:Pi}}=Si,{format:Mi,parse:$i}=lr,{toBuffer:Di}=Ye,Wi=30*1e3,hr=Symbol("kAborted"),ht=[8,13],Q=["CONNECTING","OPEN","CLOSING","CLOSED"],ji=/^[!#$%&'*+\-.0-9A-Z^_`|a-z~]+$/;let $=class A extends bi{constructor(r,i,a){super(),this._binaryType=Kt[0],this._closeCode=1006,this._closeFrameReceived=!1,this._closeFrameSent=!1,this._closeMessage=$e,this._closeTimer=null,this._extensions={},this._paused=!1,this._protocol="",this._readyState=A.CONNECTING,this._receiver=null,this._sender=null,this._socket=null,r!==null?(this._bufferedAmount=0,this._isServer=!1,this._redirects=0,i===void 0?i=[]:Array.isArray(i)||(typeof i=="object"&&i!==null?(a=i,i=[]):i=[i]),dr(this,r,i,a)):this._isServer=!0}get binaryType(){return this._binaryType}set binaryType(r){Kt.includes(r)&&(this._binaryType=r,this._receiver&&(this._receiver._binaryType=r))}get bufferedAmount(){return this._socket?this._socket._writableState.length+this._sender._bufferedBytes:this._bufferedAmount}get extensions(){return Object.keys(this._extensions).join()}get isPaused(){return this._paused}get onclose(){return null}get onerror(){return null}get onopen(){return null}get onmessage(){return null}get protocol(){return this._protocol}get readyState(){return this._readyState}get url(){return this._url}setSocket(r,i,a){const f=new Oi({binaryType:this.binaryType,extensions:this._extensions,isServer:this._isServer,maxPayload:a.maxPayload,skipUTF8Validation:a.skipUTF8Validation});this._sender=new Fi(r,this._extensions,a.generateMask),this._receiver=f,this._socket=r,f[q]=this,r[q]=this,f.on("conclude",qi),f.on("drain",Yi),f.on("error",Hi),f.on("message",zi),f.on("ping",Xi),f.on("pong",Ki),r.setTimeout(0),r.setNoDelay(),i.length>0&&r.unshift(i),r.on("close",mr),r.on("data",Ke),r.on("end",yr),r.on("error",gr),this._readyState=A.OPEN,this.emit("open")}emitClose(){if(!this._socket){this._readyState=A.CLOSED,this.emit("close",this._closeCode,this._closeMessage);return}this._extensions[ne.extensionName]&&this._extensions[ne.extensionName].cleanup(),this._receiver.removeAllListeners(),this._readyState=A.CLOSED,this.emit("close",this._closeCode,this._closeMessage)}close(r,i){if(this.readyState!==A.CLOSED){if(this.readyState===A.CONNECTING){Y(this,this._req,"WebSocket was closed before the connection was established");return}if(this.readyState===A.CLOSING){this._closeFrameSent&&(this._closeFrameReceived||this._receiver._writableState.errorEmitted)&&this._socket.end();return}this._readyState=A.CLOSING,this._sender.close(r,i,!this._isServer,a=>{a||(this._closeFrameSent=!0,(this._closeFrameReceived||this._receiver._writableState.errorEmitted)&&this._socket.end())}),this._closeTimer=setTimeout(this._socket.destroy.bind(this._socket),Wi)}}pause(){this.readyState===A.CONNECTING||this.readyState===A.CLOSED||(this._paused=!0,this._socket.pause())}ping(r,i,a){if(this.readyState===A.CONNECTING)throw new Error("WebSocket is not open: readyState 0 (CONNECTING)");if(typeof r=="function"?(a=r,r=i=void 0):typeof i=="function"&&(a=i,i=void 0),typeof r=="number"&&(r=r.toString()),this.readyState!==A.OPEN){pt(this,r,a);return}i===void 0&&(i=!this._isServer),this._sender.ping(r||$e,i,a)}pong(r,i,a){if(this.readyState===A.CONNECTING)throw new Error("WebSocket is not open: readyState 0 (CONNECTING)");if(typeof r=="function"?(a=r,r=i=void 0):typeof i=="function"&&(a=i,i=void 0),typeof r=="number"&&(r=r.toString()),this.readyState!==A.OPEN){pt(this,r,a);return}i===void 0&&(i=!this._isServer),this._sender.pong(r||$e,i,a)}resume(){this.readyState===A.CONNECTING||this.readyState===A.CLOSED||(this._paused=!1,this._receiver._writableState.needDrain||this._socket.resume())}send(r,i,a){if(this.readyState===A.CONNECTING)throw new Error("WebSocket is not open: readyState 0 (CONNECTING)");if(typeof i=="function"&&(a=i,i={}),typeof r=="number"&&(r=r.toString()),this.readyState!==A.OPEN){pt(this,r,a);return}const f={binary:typeof r!="string",mask:!this._isServer,compress:!0,fin:!0,...i};this._extensions[ne.extensionName]||(f.compress=!1),this._sender.send(r||$e,f,a)}terminate(){if(this.readyState!==A.CLOSED){if(this.readyState===A.CONNECTING){Y(this,this._req,"WebSocket was closed before the connection was established");return}this._socket&&(this._readyState=A.CLOSING,this._socket.destroy())}}};Object.defineProperty($,"CONNECTING",{enumerable:!0,value:Q.indexOf("CONNECTING")});Object.defineProperty($.prototype,"CONNECTING",{enumerable:!0,value:Q.indexOf("CONNECTING")});Object.defineProperty($,"OPEN",{enumerable:!0,value:Q.indexOf("OPEN")});Object.defineProperty($.prototype,"OPEN",{enumerable:!0,value:Q.indexOf("OPEN")});Object.defineProperty($,"CLOSING",{enumerable:!0,value:Q.indexOf("CLOSING")});Object.defineProperty($.prototype,"CLOSING",{enumerable:!0,value:Q.indexOf("CLOSING")});Object.defineProperty($,"CLOSED",{enumerable:!0,value:Q.indexOf("CLOSED")});Object.defineProperty($.prototype,"CLOSED",{enumerable:!0,value:Q.indexOf("CLOSED")});["binaryType","bufferedAmount","extensions","isPaused","protocol","readyState","url"].forEach(s=>{Object.defineProperty($.prototype,s,{enumerable:!0})});["open","error","close","message"].forEach(s=>{Object.defineProperty($.prototype,`on${s}`,{enumerable:!0,get(){for(const r of this.listeners(s))if(r[ut])return r[Li];return null},set(r){for(const i of this.listeners(s))if(i[ut]){this.removeListener(s,i);break}typeof r=="function"&&this.addEventListener(s,r,{[ut]:!0})}})});$.prototype.addEventListener=Ai;$.prototype.removeEventListener=Pi;var pr=$;function dr(s,r,i,a){const f={protocolVersion:ht[1],maxPayload:104857600,skipUTF8Validation:!1,perMessageDeflate:!0,followRedirects:!1,maxRedirects:10,...a,createConnection:void 0,socketPath:void 0,hostname:void 0,protocol:void 0,timeout:void 0,method:"GET",host:void 0,path:void 0,port:void 0};if(!ht.includes(f.protocolVersion))throw new RangeError(`Unsupported protocol version: ${f.protocolVersion} (supported versions: ${ht.join(", ")})`);let c;if(r instanceof ct)c=r,s._url=r.href;else{try{c=new ct(r)}catch{throw new SyntaxError(`Invalid URL: ${r}`)}s._url=r}const p=c.protocol==="wss:",l=c.protocol==="ws+unix:";let m;if(c.protocol!=="ws:"&&!p&&!l?m=`The URL's protocol must be one of "ws:", "wss:", or "ws+unix:"`:l&&!c.pathname?m="The URL's pathname is empty":c.hash&&(m="The URL contains a fragment identifier"),m){const x=new SyntaxError(m);if(s._redirects===0)throw x;We(s,x);return}const _=p?443:80,E=Ci(16).toString("base64"),y=p?ki.request:Ii.request,b=new Set;let g;if(f.createConnection=p?Vi:Gi,f.defaultPort=f.defaultPort||_,f.port=c.port||_,f.host=c.hostname.startsWith("[")?c.hostname.slice(1,-1):c.hostname,f.headers={...f.headers,"Sec-WebSocket-Version":f.protocolVersion,"Sec-WebSocket-Key":E,Connection:"Upgrade",Upgrade:"websocket"},f.path=c.pathname+c.search,f.timeout=f.handshakeTimeout,f.perMessageDeflate&&(g=new ne(f.perMessageDeflate!==!0?f.perMessageDeflate:{},!1,f.maxPayload),f.headers["Sec-WebSocket-Extensions"]=Mi({[ne.extensionName]:g.offer()})),i.length){for(const x of i){if(typeof x!="string"||!ji.test(x)||b.has(x))throw new SyntaxError("An invalid or duplicated subprotocol was specified");b.add(x)}f.headers["Sec-WebSocket-Protocol"]=i.join(",")}if(f.origin&&(f.protocolVersion<13?f.headers["Sec-WebSocket-Origin"]=f.origin:f.headers.Origin=f.origin),(c.username||c.password)&&(f.auth=`${c.username}:${c.password}`),l){const x=f.path.split(":");f.socketPath=x[0],f.path=x[1]}let w;if(f.followRedirects){if(s._redirects===0){s._originalIpc=l,s._originalSecure=p,s._originalHostOrSocketPath=l?f.socketPath:c.host;const x=a&&a.headers;if(a={...a,headers:{}},x)for(const[B,U]of Object.entries(x))a.headers[B.toLowerCase()]=U}else if(s.listenerCount("redirect")===0){const x=l?s._originalIpc?f.socketPath===s._originalHostOrSocketPath:!1:s._originalIpc?!1:c.host===s._originalHostOrSocketPath;(!x||s._originalSecure&&!p)&&(delete f.headers.authorization,delete f.headers.cookie,x||delete f.headers.host,f.auth=void 0)}f.auth&&!a.headers.authorization&&(a.headers.authorization="Basic "+Buffer.from(f.auth).toString("base64")),w=s._req=y(f),s._redirects&&s.emit("redirect",s.url,w)}else w=s._req=y(f);f.timeout&&w.on("timeout",()=>{Y(s,w,"Opening handshake has timed out")}),w.on("error",x=>{w===null||w[hr]||(w=s._req=null,We(s,x))}),w.on("response",x=>{const B=x.headers.location,U=x.statusCode;if(B&&f.followRedirects&&U>=300&&U<400){if(++s._redirects>f.maxRedirects){Y(s,w,"Maximum redirects exceeded");return}w.abort();let T;try{T=new ct(B,r)}catch{const D=new SyntaxError(`Invalid URL: ${B}`);We(s,D);return}dr(s,T,i,a)}else s.emit("unexpected-response",w,x)||Y(s,w,`Unexpected server response: ${x.statusCode}`)}),w.on("upgrade",(x,B,U)=>{if(s.emit("upgrade",x),s.readyState!==$.CONNECTING)return;if(w=s._req=null,x.headers.upgrade.toLowerCase()!=="websocket"){Y(s,B,"Invalid Upgrade header");return}const T=Ui("sha1").update(E+Ni).digest("base64");if(x.headers["sec-websocket-accept"]!==T){Y(s,B,"Invalid Sec-WebSocket-Accept header");return}const F=x.headers["sec-websocket-protocol"];let D;if(F!==void 0?b.size?b.has(F)||(D="Server sent an invalid subprotocol"):D="Server sent a subprotocol but none was requested":b.size&&(D="Server sent no subprotocol"),D){Y(s,B,D);return}F&&(s._protocol=F);const O=x.headers["sec-websocket-extensions"];if(O!==void 0){if(!g){Y(s,B,"Server sent a Sec-WebSocket-Extensions header but no extension was requested");return}let ee;try{ee=$i(O)}catch{Y(s,B,"Invalid Sec-WebSocket-Extensions header");return}const te=Object.keys(ee);if(te.length!==1||te[0]!==ne.extensionName){Y(s,B,"Server indicated an extension that was not requested");return}try{g.accept(ee[ne.extensionName])}catch{Y(s,B,"Invalid Sec-WebSocket-Extensions header");return}s._extensions[ne.extensionName]=g}s.setSocket(B,U,{generateMask:f.generateMask,maxPayload:f.maxPayload,skipUTF8Validation:f.skipUTF8Validation})}),f.finishRequest?f.finishRequest(w,s):w.end()}function We(s,r){s._readyState=$.CLOSING,s.emit("error",r),s.emitClose()}function Gi(s){return s.path=s.socketPath,cr.connect(s)}function Vi(s){return s.path=void 0,!s.servername&&s.servername!==""&&(s.servername=cr.isIP(s.host)?"":s.host),Ti.connect(s)}function Y(s,r,i){s._readyState=$.CLOSING;const a=new Error(i);Error.captureStackTrace(a,Y),r.setHeader?(r[hr]=!0,r.abort(),r.socket&&!r.socket.destroyed&&r.socket.destroy(),process.nextTick(We,s,a)):(r.destroy(a),r.once("error",s.emit.bind(s,"error")),r.once("close",s.emitClose.bind(s)))}function pt(s,r,i){if(r){const a=Di(r).length;s._socket?s._sender._bufferedBytes+=a:s._bufferedAmount+=a}if(i){const a=new Error(`WebSocket is not open: readyState ${s.readyState} (${Q[s.readyState]})`);process.nextTick(i,a)}}function qi(s,r){const i=this[q];i._closeFrameReceived=!0,i._closeMessage=r,i._closeCode=s,i._socket[q]!==void 0&&(i._socket.removeListener("data",Ke),process.nextTick(_r,i._socket),s===1005?i.close():i.close(s,r))}function Yi(){const s=this[q];s.isPaused||s._socket.resume()}function Hi(s){const r=this[q];r._socket[q]!==void 0&&(r._socket.removeListener("data",Ke),process.nextTick(_r,r._socket),r.close(s[Ri])),r.emit("error",s)}function Zt(){this[q].emitClose()}function zi(s,r){this[q].emit("message",s,r)}function Xi(s){const r=this[q];r.pong(s,!r._isServer,ur),r.emit("ping",s)}function Ki(s){this[q].emit("pong",s)}function _r(s){s.resume()}function mr(){const s=this[q];this.removeListener("close",mr),this.removeListener("data",Ke),this.removeListener("end",yr),s._readyState=$.CLOSING;let r;!this._readableState.endEmitted&&!s._closeFrameReceived&&!s._receiver._writableState.errorEmitted&&(r=s._socket.read())!==null&&s._receiver.write(r),s._receiver.end(),this[q]=void 0,clearTimeout(s._closeTimer),s._receiver._writableState.finished||s._receiver._writableState.errorEmitted?s.emitClose():(s._receiver.on("error",Zt),s._receiver.on("finish",Zt))}function Ke(s){this[q]._receiver.write(s)||this.pause()}function yr(){const s=this[q];s._readyState=$.CLOSING,s._receiver.end(),this.end()}function gr(){const s=this[q];this.removeListener("error",gr),this.on("error",ur),s&&(s._readyState=$.CLOSING,this.destroy())}const xn=Ie(pr),{tokenChars:Zi}=ze;function Ji(s){const r=new Set;let i=-1,a=-1,f=0;for(f;f<s.length;f++){const p=s.charCodeAt(f);if(a===-1&&Zi[p]===1)i===-1&&(i=f);else if(f!==0&&(p===32||p===9))a===-1&&i!==-1&&(a=f);else if(p===44){if(i===-1)throw new SyntaxError(`Unexpected character at index ${f}`);a===-1&&(a=f);const l=s.slice(i,a);if(r.has(l))throw new SyntaxError(`The "${l}" subprotocol is duplicated`);r.add(l),i=a=-1}else throw new SyntaxError(`Unexpected character at index ${f}`)}if(i===-1||a!==-1)throw new SyntaxError("Unexpected end of input");const c=s.slice(i,f);if(r.has(c))throw new SyntaxError(`The "${c}" subprotocol is duplicated`);return r.add(c),r}var Qi={parse:Ji};const en=V,qe=V,{createHash:tn}=V,Jt=lr,oe=He,rn=Qi,nn=pr,{GUID:sn,kWebSocket:on}=le,an=/^[+/0-9A-Za-z]{22}==$/,Qt=0,er=1,Er=2;class fn extends en{constructor(r,i){if(super(),r={maxPayload:100*1024*1024,skipUTF8Validation:!1,perMessageDeflate:!1,handleProtocols:null,clientTracking:!0,verifyClient:null,noServer:!1,backlog:null,server:null,host:null,path:null,port:null,WebSocket:nn,...r},r.port==null&&!r.server&&!r.noServer||r.port!=null&&(r.server||r.noServer)||r.server&&r.noServer)throw new TypeError('One and only one of the "port", "server", or "noServer" options must be specified');if(r.port!=null?(this._server=qe.createServer((a,f)=>{const c=qe.STATUS_CODES[426];f.writeHead(426,{"Content-Length":c.length,"Content-Type":"text/plain"}),f.end(c)}),this._server.listen(r.port,r.host,r.backlog,i)):r.server&&(this._server=r.server),this._server){const a=this.emit.bind(this,"connection");this._removeListeners=cn(this._server,{listening:this.emit.bind(this,"listening"),error:this.emit.bind(this,"error"),upgrade:(f,c,p)=>{this.handleUpgrade(f,c,p,a)}})}r.perMessageDeflate===!0&&(r.perMessageDeflate={}),r.clientTracking&&(this.clients=new Set,this._shouldEmitClose=!1),this.options=r,this._state=Qt}address(){if(this.options.noServer)throw new Error('The server is operating in "noServer" mode');return this._server?this._server.address():null}close(r){if(this._state===Er){r&&this.once("close",()=>{r(new Error("The server is not running"))}),process.nextTick(Be,this);return}if(r&&this.once("close",r),this._state!==er)if(this._state=er,this.options.noServer||this.options.server)this._server&&(this._removeListeners(),this._removeListeners=this._server=null),this.clients?this.clients.size?this._shouldEmitClose=!0:process.nextTick(Be,this):process.nextTick(Be,this);else{const i=this._server;this._removeListeners(),this._removeListeners=this._server=null,i.close(()=>{Be(this)})}}shouldHandle(r){if(this.options.path){const i=r.url.indexOf("?");if((i!==-1?r.url.slice(0,i):r.url)!==this.options.path)return!1}return!0}handleUpgrade(r,i,a,f){i.on("error",tr);const c=r.headers["sec-websocket-key"],p=+r.headers["sec-websocket-version"];if(r.method!=="GET"){fe(this,r,i,405,"Invalid HTTP method");return}if(r.headers.upgrade.toLowerCase()!=="websocket"){fe(this,r,i,400,"Invalid Upgrade header");return}if(!c||!an.test(c)){fe(this,r,i,400,"Missing or invalid Sec-WebSocket-Key header");return}if(p!==8&&p!==13){fe(this,r,i,400,"Missing or invalid Sec-WebSocket-Version header");return}if(!this.shouldHandle(r)){ke(i,400);return}const l=r.headers["sec-websocket-protocol"];let m=new Set;if(l!==void 0)try{m=rn.parse(l)}catch{fe(this,r,i,400,"Invalid Sec-WebSocket-Protocol header");return}const _=r.headers["sec-websocket-extensions"],E={};if(this.options.perMessageDeflate&&_!==void 0){const y=new oe(this.options.perMessageDeflate,!0,this.options.maxPayload);try{const b=Jt.parse(_);b[oe.extensionName]&&(y.accept(b[oe.extensionName]),E[oe.extensionName]=y)}catch{fe(this,r,i,400,"Invalid or unacceptable Sec-WebSocket-Extensions header");return}}if(this.options.verifyClient){const y={origin:r.headers[`${p===8?"sec-websocket-origin":"origin"}`],secure:!!(r.socket.authorized||r.socket.encrypted),req:r};if(this.options.verifyClient.length===2){this.options.verifyClient(y,(b,g,w,x)=>{if(!b)return ke(i,g||401,w,x);this.completeUpgrade(E,c,m,r,i,a,f)});return}if(!this.options.verifyClient(y))return ke(i,401)}this.completeUpgrade(E,c,m,r,i,a,f)}completeUpgrade(r,i,a,f,c,p,l){if(!c.readable||!c.writable)return c.destroy();if(c[on])throw new Error("server.handleUpgrade() was called more than once with the same socket, possibly due to a misconfiguration");if(this._state>Qt)return ke(c,503);const _=["HTTP/1.1 101 Switching Protocols","Upgrade: websocket","Connection: Upgrade",`Sec-WebSocket-Accept: ${tn("sha1").update(i+sn).digest("base64")}`],E=new this.options.WebSocket(null);if(a.size){const y=this.options.handleProtocols?this.options.handleProtocols(a,f):a.values().next().value;y&&(_.push(`Sec-WebSocket-Protocol: ${y}`),E._protocol=y)}if(r[oe.extensionName]){const y=r[oe.extensionName].params,b=Jt.format({[oe.extensionName]:[y]});_.push(`Sec-WebSocket-Extensions: ${b}`),E._extensions=r}this.emit("headers",_,f),c.write(_.concat(`\r
`).join(`\r
`)),c.removeListener("error",tr),E.setSocket(c,p,{maxPayload:this.options.maxPayload,skipUTF8Validation:this.options.skipUTF8Validation}),this.clients&&(this.clients.add(E),E.on("close",()=>{this.clients.delete(E),this._shouldEmitClose&&!this.clients.size&&process.nextTick(Be,this)})),l(E,f)}}var ln=fn;function cn(s,r){for(const i of Object.keys(r))s.on(i,r[i]);return function(){for(const a of Object.keys(r))s.removeListener(a,r[a])}}function Be(s){s._state=Er,s.emit("close")}function tr(){this.destroy()}function ke(s,r,i,a){i=i||qe.STATUS_CODES[r],a={Connection:"close","Content-Type":"text/html","Content-Length":Buffer.byteLength(i),...a},s.once("finish",s.destroy),s.end(`HTTP/1.1 ${r} ${qe.STATUS_CODES[r]}\r
`+Object.keys(a).map(f=>`${f}: ${a[f]}`).join(`\r
`)+`\r
\r
`+i)}function fe(s,r,i,a,f){if(s.listenerCount("wsClientError")){const c=new Error(f);Error.captureStackTrace(c,fe),s.emit("wsClientError",c,i,r)}else ke(i,a,f)}const wn=Ie(ln);export{gn as Receiver,En as Sender,xn as WebSocket,wn as WebSocketServer,dn as createWebSocketStream,xn as default};
